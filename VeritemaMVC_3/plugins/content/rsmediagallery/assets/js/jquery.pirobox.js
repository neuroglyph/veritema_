(function(e){e.fn.piroBox_content=function(t){function C(){e(window).scroll(function(){var t=e(window).height();var n=e(window).width();var r=h.height();var i=h.width();h.css({left:n/2-i/2+"px",top:parseInt(e(document).scrollTop())+(t-r)/2})})}function k(){if(h.is(":visible")){e(".my_frame").remove();h.add(y).add(w).stop();var n=h;if(e.browser.msie){n=y.add(d);e(".div_reg_"+t.htmlClass+" img").remove()}else{n=h.add(d)}n.piroFadeOut(200,function(){y.html("");b.add(p).add(E).hide();S.hide();d.add(h).hide().css("visibility","visible")})}}t=jQuery.extend({piro_speed:700,bg_alpha:.9,piro_scroll:true,draggable:false,selector:'a[class*="pirobox"]',htmlClass:""},t);e.fn.piroFadeIn=function(t,n){e(this).fadeIn(t,function(){if(jQuery.browser.msie)e(this).get(0).style.removeAttribute("filter");if(n!=undefined)n()})};e.fn.piroFadeOut=function(t,n){e(this).fadeOut(t,function(){if(jQuery.browser.msie)e(this).get(0).style.removeAttribute("filter");if(n!=undefined)n()})};var n=e(t.selector);var r=new Object;for(var i=0;i<n.length;i++){var s=e(n[i]);r["a."+s.attr("class").match(/^pirobox_gall\w*/)]=0}var o=new Array;for(var u in r){o.push(u)}for(var i=0;i<o.length;i++){e(o[i]+":first").addClass("rsmg_content_first");e(o[i]+":last").addClass("rsmg_content_last")}var a=e(n);var f="";var l=0;e(t.selector).each(function(t){var n=e(this).attr("class");n=n.replace("rs_plg_content","");n=n.replace("rsmg_content_first","");n=n.replace("rsmg_content_last","");n=n.trim();if(n==f){this.rev=n+"-"+l;l++}else{l=0;this.rev=n+"-"+l;l++}f=n});var c='<div class="piro_overlay piro_overlay_'+t.htmlClass+'"></div>'+'<table class="piro_html piro_html_'+t.htmlClass+'" cellpadding="0" cellspacing="0">'+"<tr>"+'<td class="h_t_l"></td>'+'<td class="h_t_c"></td>'+'<td class="h_t_r"></td>'+"</tr>"+"<tr>"+'<td class="h_c_l"></td>'+'<td class="h_c_c">'+'<div class="piro_loader piro_loader_'+t.htmlClass+'" title="close"><span></span></div>'+'<div class="resize resize_'+t.htmlClass+'">'+'<div class="piro_nav_container piro_nav_container_'+t.htmlClass+'">'+'<a href="#prev" class="piro_prev piro_prev_'+t.htmlClass+'" title="previous"></a>'+'<a href="#next" class="piro_next piro_next_'+t.htmlClass+'" title="next"></a>'+'<div class="piro_close piro_close_'+t.htmlClass+'" title="close"></div>'+"</div>"+'<div class="piro_caption piro_caption_'+t.htmlClass+'"></div>'+'<div class="div_reg div_reg_'+t.htmlClass+'"></div>'+"</div>"+"</td>"+'<td class="h_c_r"></td>'+"</tr>"+"<tr>"+'<td class="h_b_l"></td>'+'<td class="h_b_c"></td>'+'<td class="h_b_r"></td>'+"</tr>"+"</table>";e("body").append(c);var h=e(".piro_html_"+t.htmlClass),p=e(".piro_caption_"+t.htmlClass),d=e(".piro_overlay_"+t.htmlClass),v=e(".piro_next_"+t.htmlClass),m=e(".piro_prev_"+t.htmlClass),g=e(".piro_close_"+t.htmlClass),y=e(".div_reg_"+t.htmlClass),b=e(".piro_loader_"+t.htmlClass),w=e(".resize_"+t.htmlClass),E=e(".btn_info"),S=e(".piro_nav_container_"+t.htmlClass);var x=.95;if(t.draggable){if(e.browser.msie){h.draggable({handle:".h_t_c,.h_b_c,.div_reg_"+t.htmlClass+" img"})}else{h.draggable({handle:".h_t_c,.h_b_c,.div_reg_"+t.htmlClass+" img",opacity:.8})}}var T=e(window).height();var N=e(window).width();S.hide();h.css({left:N/2-250+"px",top:parseInt(e(document).scrollTop())+100});e(h).add(p).add(d).hide();d.css({opacity:t.bg_alpha});e(m).add(v).bind("click",function(n){var r=S.hide();n.preventDefault();v.add(m).hide();var i=e(t.selector).filter(".rsmg_content_item").attr("rev");i=i.split("-");var s=parseInt(i[1]);var o=e(this).is(m)?s-1:s+1;e(t.selector).each(function(){if(e(this).attr("rev")==i[0]+"-"+o){var t=e(this);t.click()}})});e("html").bind("keyup",function(t){if(t.keyCode==27){t.preventDefault();if(e(g).is(":visible")){k()}}});e("html").bind("keyup",function(t){if(e(".rsmg_content_item").is(".rsmg_content_first")){}else if(t.keyCode==37){t.preventDefault();if(e(g).is(":visible")){m.click()}}});e("html").bind("keyup",function(t){if(e(".rsmg_content_item").is(".rsmg_content_last")){}else if(t.keyCode==39){t.preventDefault();if(e(g).is(":visible")){v.click()}}});e(window).resize(function(){var t=e(window).height();var n=e(window).width();var r=h.height();var i=h.width();h.css({left:n/2-i/2+"px",top:parseInt(e(document).scrollTop())+(t-r)/2})});if(t.piro_scroll==true){C()}e(a).each(function(){function o(){function i(){if(r[1]=="full"&&r[2]=="full"){r[2]=e(window).height()-70;r[1]=e(window).width()-55}var n=e(window).height();var i=e(window).width();g.hide();y.add(w).animate({height:+r[2]+"px",width:+r[1]+"px"},t.piro_speed).css("visibility","visible");h.animate({height:+r[2]+20+"px",width:+r[1]+20+"px",left:i/2-(r[1]/2+10)+"px",top:parseInt(e(document).scrollTop())+(n-r[2])/2-10},t.piro_speed,function(){v.add(m).css({height:"20px",width:"20px"});v.add(m).css("visibility","visible");S.show();g.show()})}function o(){var n=new Image;n.onload=function(){p.add(E).hide();var r=e(window).height();var i=e(window).width();var s=n.height;var o=n.width;if(s+20>r||o+20>i){var u=(o+20)/i;var a=(s+20)/r;if(a>u){o=Math.round(n.width*(x/a));s=Math.round(n.height*(x/a))}else{o=Math.round(n.width*(x/u));s=Math.round(n.height*(x/u))}}else{s=n.height;o=n.width}var r=e(window).height();var i=e(window).width();e(n).height(s).width(o).hide();e(n).fadeOut(300,function(){});e(".div_reg_"+t.htmlClass+" img").remove();e(".div_reg_"+t.htmlClass+"").html("");y.append(n).show();e(n).addClass("immagine");y.add(w).animate({height:s+"px",width:o+"px"},t.piro_speed);h.animate({height:s+20+"px",width:o+20+"px",left:i/2-(o+20)/2+"px",top:parseInt(e(document).scrollTop())+(r-s)/2-20},t.piro_speed,function(){var t=w.width();p.css({width:t+"px"});b.hide();e(n).fadeIn(300,function(){g.add(E).show();p.slideDown(200);v.add(m).css({height:"20px",width:"20px"});v.add(m).css("visibility","visible");S.show();w.resize(function(){NimgW=n.width;NimgH=n.heigh;p.css({width:NimgW+"px"})})})})};n.src=s;b.click(function(){n.src="about:blank"})}h.add(d).add(y).add(b).show();switch(r[0]){case"iframe":y.html("").css("overflow","hidden");w.css("overflow","hidden");g.add(E).add(p).hide();i();y.piroFadeIn(300,function(){y.append('<iframe id="my_frame" class="my_frame" src="'+s+'" frameborder="0" allowtransparency="true" scrolling="auto" align="top"></iframe>');e(".my_frame").css({height:+r[2]+"px",width:+r[1]+"px"});b.hide()});break;case"content":y.html("").css("overflow","auto");w.css("overflow","auto");e(".my_frame").remove();g.add(E).add(p).hide();i();y.piroFadeIn(300,function(){y.load(s);b.hide()});break;case"inline":y.html("").css("overflow","auto");w.css("overflow","auto");e(".my_frame").remove();g.add(E).add(p).hide();i();y.piroFadeIn(300,function(){e(s).clone(true).appendTo(y).piroFadeIn(300);b.hide()});break;case"gallery":y.css("overflow","hidden");w.css("overflow","hidden");e(".my_frame").remove();g.add(E).add(p).hide();if(typeof n!="undefined"){if(n=="")p.html("");else{p.html("<p>"+n+"</p>");var u=e('<div id="piro_close_desc">x</div>');p.append(u)}}o();break;case"single":g.add(E).add(p).hide();y.html("").css("overflow","hidden");w.css("overflow","hidden");e(".my_frame").remove();if(typeof n!="undefined"){if(n=="")p.html("");else{p.html("<p>"+n+"</p>");var u=e('<div id="piro_close_desc">x</div>');p.append(u)}}o();break}}var n=e(this).attr("title");e(this).removeAttr("title");var r=e(this).attr("rel").split("-");var i=e(this).attr("data-filter");var s=e(this).attr("href");e(this).unbind();e(this).bind("click",function(n){d.css({opacity:t.bg_alpha});n.preventDefault();v.add(m).hide().css("visibility","hidden");e(a).filter(".rsmg_content_item").removeClass("rsmg_content_item");e(this).addClass("rsmg_content_item");o();if(e(this).is(".rsmg_content_first")){m.hide();v.show()}else{v.add(m).show()}if(e(this).is(".rsmg_content_last")){if(!e(this).is(".rsmg_content_first"))m.show();v.hide()}if(e(this).is(".pirobox")){v.add(m).hide()}})});e("#piro_close_desc").live("click",function(){p.slideToggle(200)});g.add(b).add(d).bind("click",function(e){e.preventDefault();k()})}})(jQuery)