(function($){$.fn.lightBox=function(settings){function _initialize(){_start(this,jQueryMatchedObj);return false}function _start(e,t){$("embed, object, select").css({visibility:"hidden"});_set_interface();settings.imageArray.length=0;settings.activeImage=0;settings.ajaxEndChecks=0;if(t.length==1){href=_get_full_image(e);title=_get_title(e);group=_get_group(e);id=_get_id(e);settings.addImage(settings,href,title,id,group)}else{for(var n=0;n<t.length;n++){href=_get_full_image(t[n]);title=_get_title(t[n]);group=_get_group(t[n]);id=_get_id(t[n]);if(href==_get_full_image(e))settings.activeImage=n;settings.addImage(settings,href,title,id,group)}}_set_image_to_view()}function _get_full_image(obj){rel=$(obj).attr("rel");if(typeof rel!="undefined"&&rel.indexOf("{")>-1&&rel.indexOf("}")>-1){eval("var decoded_rel = "+rel+";");if(typeof decoded_rel=="object"&&decoded_rel.link)return decoded_rel.link}return""}function _get_title(obj){rel=$(obj).attr("rel");if(typeof rel!="undefined"&&rel.indexOf("{")>-1&&rel.indexOf("}")>-1){eval("var decoded_rel = "+rel+";");if(typeof decoded_rel=="object"&&decoded_rel.title)return decoded_rel.title}return""}function _get_group(obj){rel=$(obj).attr("rel");if(typeof rel!="undefined"&&rel.indexOf("{")>-1&&rel.indexOf("}")>-1){eval("var decoded_rel = "+rel+";");if(typeof decoded_rel=="object"&&decoded_rel.group)return decoded_rel.group}return""}function _get_id(obj){rel=$(obj).attr("rel");if(typeof rel!="undefined"&&rel.indexOf("{")>-1&&rel.indexOf("}")>-1){eval("var decoded_rel = "+rel+";");if(typeof decoded_rel=="object"&&decoded_rel.id)return decoded_rel.id}return""}function _set_interface(){$("body").append('<div id="jquery-overlay"></div><div id="jquery-lightbox"><div id="lightbox-container-navigation-box"><a href="#" id="lightbox-nav-btnPrev"></a><a href="#" id="lightbox-nav-btnNext"></a><div id="lightbox-container-image-box"><div id="lightbox-container-image"><div id="lightbox-btnClose"><a href="#" id="lightbox-secNav-btnClose">'+settings.imageCloseText+'</a></div><img id="lightbox-image"><div id="lightbox-loading"><a href="#" id="lightbox-loading-link"></a></div></div></div></div><div id="lightbox-container-image-data-box"><div id="lightbox-container-image-data"><div id="lightbox-image-details"><span id="lightbox-image-details-caption"></span></div></div></div></div>');$("#lightbox-container-image").hover(function(e){$("#lightbox-btnClose").fadeIn("fast")},function(e){$("#lightbox-btnClose").fadeOut("fast")});var e=___getPageSize();$("#jquery-overlay").css({opacity:settings.overlayOpacity,width:e[0],height:e[1]}).fadeIn();var t=___getPageScroll();$("#jquery-lightbox").css({top:t[1]+e[3]/10,left:t[0]}).show();$("#jquery-overlay,#jquery-lightbox").click(function(e){if($(e.target).parents("#lightbox-container-image-data-box").length==0)_finish()});$("#lightbox-loading-link,#lightbox-btnClose").click(function(){_finish();return false});$(window).resize(_resize_overlay_with_scroll);$(window).scroll(_resize_overlay_without_scroll)}function _resize_overlay_with_scroll(){_resize_overlay();_position_lightbox();var e=new Image;e.src=$("#lightbox-image").attr("src");if((newsizes=_need_to_resize(e.width,e.height))!==false){_hide_elements();_resize_container_image_box(e.width,e.height)}}function _resize_overlay_without_scroll(){_resize_overlay()}function _resize_overlay(){var e=___getPageSize();$("#jquery-overlay").css({width:e[0],height:e[1]})}function _position_lightbox(){var e=___getPageSize();var t=___getPageScroll();$("#jquery-lightbox").css({top:t[1]+e[3]/10,left:t[0]})}function _hide_elements(){$("#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext,#lightbox-container-image-data-box").hide();$("#lightbox-btnClose").hide()}function _show_elements(){$("#lightbox-container-image-data-box").show();$("#lightbox-btnClose").show()}function _set_image_to_view(){$("#lightbox-loading").show();_hide_elements();var e=new Image;e.onload=function(){$("#lightbox-image").attr("src",settings.imageArray[settings.activeImage][0]);$("#lightbox-image").attr("rel",settings.imageArray[settings.activeImage][2]);_resize_container_image_box(e.width,e.height);settings.onImageLoad(settings);e.onload=function(){}};e.src=settings.imageArray[settings.activeImage][0]}function _resize_container_image_box(e,t){if((newsizes=_need_to_resize(e,t))!==false){e=newsizes[0];t=newsizes[1];$("#lightbox-image").css("width","100%")}var n=$("body").width();var r=$("body").innerWidth()-n;var i=$("body").outerWidth(true)-$("body").outerWidth();n=n+r+i;var s=$("#lightbox-container-image-box").width();var o=$("#lightbox-container-image-box").height();var u=e+settings.containerBorderSize*2;var a=t+settings.containerBorderSize*2;var f=s-u;var l=o-a;var c=100;var h=n-u;if(h<c){c=c-(c-h)}$("#lightbox-container-navigation-box").css("width",u+c+"px");$("#lightbox-container-image-box").animate({width:u,height:a},settings.containerResizeSpeed,function(){_show_image()});if(f==0&&l==0){if($.browser.msie){___pause(250)}else{___pause(100)}}$("#lightbox-container-image-data-box").css({width:e});var p=$("#jquery-lightbox").offset();var d=___getPageSize();var v=p.left;var m=p.top-d[3]/10;$(window).scrollTo({top:m+"px",left:v+"px"},400)}function _need_to_resize(e,t){var n=$(window).width();if(n<=e+100){var r=e;var i=t;var s=r/i;e=Math.round(n*.8);t=Math.round(e/s);return[e,t]}return false}function _preload_ajax_images(){if(typeof settings.ajaxFunction=="function"&&!settings.ajaxEndChecks){if(settings.imageArray.length>1&&settings.activeImage==settings.imageArray.length-2||settings.imageArray.length==1||settings.imageArray.length>1&&settings.activeImage==settings.imageArray.length-1){if(!settings.ajaxFunction(settings)){settings.ajaxEndChecks=1}}}}function _show_image(){_preload_ajax_images();$("#lightbox-loading").hide();$("#lightbox-image").fadeIn("fast",function(){_show_image_data();_set_navigation()});_preload_neighbor_images()}function _show_image_data(){_show_elements();$("#lightbox-image-details-caption").hide();if(settings.imageArray[settings.activeImage][1]){$("#lightbox-image-details-caption").html(settings.imageArray[settings.activeImage][1]).show()}}function _set_navigation(){$("#lightbox-nav-btnPrev,#lightbox-nav-btnNext").addClass("lightbox-nav-btnBlank");var e=settings.imageArray[settings.activeImage][3];var t=_get_previous_image(e);var n=_get_next_image(e);if(t){$("#lightbox-nav-btnPrev").removeClass("lightbox-nav-btnBlank").unbind().bind("click",function(){settings.activeImage=t[1];_set_image_to_view();return false}).show()}if(n){$("#lightbox-nav-btnNext").removeClass("lightbox-nav-btnBlank").unbind().bind("click",function(){settings.activeImage=n[1];_set_image_to_view();return false}).show()}_enable_keyboard_navigation()}function _enable_keyboard_navigation(){$(document).keydown(_keyboard_action)}function _disable_keyboard_navigation(){$(document).unbind("keydown",_keyboard_action)}function _keyboard_action(e){keycode=e.keyCode;leftArrow=37;rightArrow=39;escapeKey=27;key=String.fromCharCode(keycode).toLowerCase();if(key==settings.keyToClose||key=="x"||keycode==escapeKey){_finish()}if(key==settings.keyToPrev||keycode==leftArrow){if(settings.activeImage!=0){settings.activeImage=settings.activeImage-1;_set_image_to_view();_disable_keyboard_navigation()}}if(key==settings.keyToNext||keycode==rightArrow){if(settings.activeImage!=settings.imageArray.length-1){settings.activeImage=settings.activeImage+1;_set_image_to_view();_disable_keyboard_navigation()}}}function _preload_neighbor_images(){var e=settings.imageArray[settings.activeImage][3];var t=_get_previous_image(e);var n=_get_next_image(e);if(t){objNext=new Image;objNext.src=t[0]}if(n){objPrev=new Image;objPrev.src=n[0]}}function _get_previous_image(e){var t=false;var n=0;for(var r=settings.activeImage-1;r>=0;r--){if(settings.imageArray[r][3]==e){if(t==false){t=settings.imageArray[r][0];n=r}}}if(t)return[t,n];else return t}function _get_next_image(e){var t=settings.imageArray.length;var n=false;var r=0;for(var i=settings.activeImage+1;i<t;i++){if(settings.imageArray[i][3]==e){if(n==false){n=settings.imageArray[i][0];r=i}}}if(n)return[n,r];else return n}function _finish(){$("#jquery-lightbox").remove();$("#jquery-overlay").fadeOut(function(){$("#jquery-overlay").remove()});$("embed, object, select").css({visibility:"visible"});$(window).unbind("resize",_resize_overlay_with_scroll);$(window).unbind("scroll",_resize_overlay_without_scroll);$(document).unbind("keydown",_keyboard_action)}function ___getPageSize(){var e,t;if(window.innerHeight&&window.scrollMaxY){e=window.innerWidth+window.scrollMaxX;t=window.innerHeight+window.scrollMaxY}else if(document.body.scrollHeight>document.body.offsetHeight){e=document.body.scrollWidth;t=document.body.scrollHeight}else{e=document.body.offsetWidth;t=document.body.offsetHeight}var n,r;if(self.innerHeight){if(document.documentElement.clientWidth){n=document.documentElement.clientWidth}else{n=self.innerWidth}r=self.innerHeight}else if(document.documentElement&&document.documentElement.clientHeight){n=document.documentElement.clientWidth;r=document.documentElement.clientHeight}else if(document.body){n=document.body.clientWidth;r=document.body.clientHeight}if(t<r){pageHeight=r}else{pageHeight=t}if(e<n){pageWidth=e}else{pageWidth=n}arrayPageSize=new Array(pageWidth,pageHeight,n,r);return arrayPageSize;pageWidth=$("body").outerWidth();pageHeight=$(document).outerHeight();n=$(window).outerWidth();r=$(window).outerHeight();return[pageWidth,pageHeight,n,r]}function ___getPageScroll(){var e=$(document).scrollLeft();var t=$(document).scrollTop();return[e,t]}function ___pause(e){var t=new Date;n=null;do{var n=new Date}while(n-t<e)}settings=jQuery.extend({overlayOpacity:.8,fixedNavigation:false,imageCloseText:"&laquo; back to gallery",containerBorderSize:10,containerResizeSpeed:200,keyToClose:"c",keyToPrev:"p",keyToNext:"n",imageArray:[],activeImage:0,ajaxEndChecks:0,ajaxFunction:function(e){return false},onImageLoad:function(e){return false},addImage:function(e,t,n,r,i){if(n.length>0&&n.charAt(0)=="#"&&$(n).length>0)n=$(n).html();e.imageArray.push([t,n,r,i])}},settings);var jQueryMatchedObj=this;return this.unbind("click").click(_initialize)}})(jQuery);(function(e){function n(e){return typeof e=="object"?e:{top:e,left:e}}var t=e.scrollTo=function(t,n,r){e(window).scrollTo(t,n,r)};t.defaults={axis:"xy",duration:parseFloat(e.fn.jquery)>=1.3?0:1};t.window=function(t){return e(window)._scrollable()};e.fn._scrollable=function(){return this.map(function(){var t=this,n=!t.nodeName||e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"])!=-1;if(!n)return t;var r=(t.contentWindow||t).document||t.ownerDocument||t;return e.browser.safari||r.compatMode=="BackCompat"?r.body:r.documentElement})};e.fn.scrollTo=function(r,i,s){if(typeof i=="object"){s=i;i=0}if(typeof s=="function")s={onAfter:s};if(r=="max")r=9e9;s=e.extend({},t.defaults,s);i=i||s.speed||s.duration;s.queue=s.queue&&s.axis.length>1;if(s.queue)i/=2;s.offset=n(s.offset);s.over=n(s.over);return this._scrollable().each(function(){function h(e){u.animate(l,i,s.easing,e&&function(){e.call(this,r,s)})}var o=this,u=e(o),a=r,f,l={},c=u.is("html,body");switch(typeof a){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(a)){a=n(a);break}a=e(a,this);case"object":if(a.is||a.style)f=(a=e(a)).offset()}e.each(s.axis.split(""),function(e,n){var r=n=="x"?"Left":"Top",i=r.toLowerCase(),p="scroll"+r,d=o[p],v=t.max(o,n);if(f){l[p]=f[i]+(c?0:d-u.offset()[i]);if(s.margin){l[p]-=parseInt(a.css("margin"+r))||0;l[p]-=parseInt(a.css("border"+r+"Width"))||0}l[p]+=s.offset[i]||0;if(s.over[i])l[p]+=a[n=="x"?"width":"height"]()*s.over[i]}else{var m=a[i];l[p]=m.slice&&m.slice(-1)=="%"?parseFloat(m)/100*v:m}if(/^\d+$/.test(l[p]))l[p]=l[p]<=0?0:Math.min(l[p],v);if(!e&&s.queue){if(d!=l[p])h(s.onAfterFirst);delete l[p]}});h(s.onAfter);}).end()};t.max=function(t,n){var r=n=="x"?"Width":"Height",i="scroll"+r;if(!e(t).is("html,body"))return t[i]-e(t)[r.toLowerCase()]();var s="client"+r,o=t.ownerDocument.documentElement,u=t.ownerDocument.body;return Math.max(o[i],u[i])-Math.min(o[s],u[s])};})(jQuery)